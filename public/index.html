<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GPTs Help – Learn Smarter with AI</title>
  <style>
    :root {
      --brand: #6f42c1;  /* Purple */
      --accent: #ffc107; /* Amber */
      --bg: #f8f9fa;
      --text: #212529;
      --muted: #6c757d;
      --panel:#ffffff;
      --border:#eeeeee;
      --shadow: 0 16px 36px rgba(0,0,0,.08);
      --error:#dc3545;
      --ok:#198754;
    }
    *{box-sizing:border-box}
    body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color:var(--text); background:var(--bg); }
    a { color: var(--brand); text-decoration: none; }

    header, footer { background:#fff; padding:1rem 2rem; border-bottom:1px solid #eee; }
    .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
    h1,h2,h3 { margin:.5rem 0; }
    p { margin:.5rem 0 1rem; }

    /* Header */
    .nav { display:flex; align-items:center; justify-content:space-between; }
    .nav .right { display:flex; gap:.5rem; }
    .btn-nav {
      border:1px solid var(--border); background:#fff; color:var(--brand);
      padding:.55rem .9rem; border-radius:10px; cursor:pointer; font-weight:600;
    }
    .btn-nav.primary { background:var(--brand); color:#fff; border-color:transparent; }

    /* Hero */
    .hero { background:linear-gradient(135deg, var(--brand), #9c6fff); color:#fff; text-align:center; padding:5rem 2rem; }
    .hero h1 { font-size:clamp(2rem,4vw,3rem); margin-bottom:1rem; }
    .hero p { font-size:1.1rem; max-width:720px; margin:0 auto 2rem; opacity:.98; }
    .btn { padding:.8rem 1.4rem; font-weight:700; border:none; border-radius:8px; cursor:pointer; }
    .btn-primary { background:var(--accent); color:#000; }
    .btn-secondary { background:#fff; color:var(--brand); border:1px solid var(--border); }

    /* Features */
    .features { display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:1.5rem; margin-top:2rem; }
    .card { background:#fff; border:1px solid #eee; border-radius:12px; padding:1.5rem; box-shadow:0 4px 10px rgba(0,0,0,0.05); }

    /* Pricing */
    .plans { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:1.5rem; margin-top:2rem; }
    .plan { background:#fff; border:1px solid #eee; border-radius:14px; padding:2rem; position:relative; text-align:center; box-shadow:var(--shadow); }
    .plan h3 { margin-bottom:.5rem; }
    .price { font-size:2rem; color:var(--brand); margin:.5rem 0 1rem; }
    .plan ul { list-style:none; padding:0; margin:1rem 0; color:var(--muted); text-align:left; }
    .plan li { margin:.35rem 0; }
    .badge { position:absolute; top:12px; right:12px; background:var(--brand); color:#fff; font-size:.75rem; padding:.25rem .5rem; border-radius:999px; }

    /* Testimonials */
    .testimonials { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:1.5rem; margin-top:2rem; }
    .testimonial { background:#fff; border:1px solid #eee; border-radius:12px; padding:1.5rem; font-style:italic; }

    footer { text-align:center; padding:2rem; color:var(--muted); margin-top:3rem; border-top:1px solid #eee; }

    /* Modals (shared) */
    .overlay {
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.45); z-index:1000;
    }
    .overlay.open { display:flex; }
    .modal {
      width:min(480px,92vw); background:var(--panel); border:1px solid var(--border);
      border-radius:14px; padding:18px; box-shadow:var(--shadow);
    }
    .modal h3 { margin:.25rem 0 4px; font-size:1.15rem; }
    .modal p.sub { color:var(--muted); margin:0 0 12px; font-size:.95rem; }
    .row { display:flex; gap:.6rem; }
    label { display:block; font-size:.9rem; color:var(--muted); margin:.35rem 0 .35rem; }
    input[type="email"], input[type="password"], input[type="text"] {
      width:100%; padding:.75rem .9rem; border:1px solid #ddd; border-radius:10px; font-size:1rem;
    }
    .modal .btn { width:100%; }
    .close-x { border:0; background:transparent; color:#999; font-size:20px; cursor:pointer; float:right; }
    .err { color:var(--error); font-size:.9rem; min-height:18px; margin-top:6px; }
    .ok { color:var(--ok); font-size:.9rem; min-height:18px; margin-top:6px; }
    .muted { color: var(--muted); font-size:.9rem; margin-top:8px; }
    .step { display:none; }
    .step.active { display:block; }
    .inline { display:flex; align-items:center; gap:.5rem; }
    .link { color:var(--brand); background:none; border:0; padding:0; cursor:pointer; font-weight:600; }

    /* Spinner */
    .spinner {
      width:16px; height:16px; border:2px solid #fff; border-right-color:transparent;
      border-radius:50%; display:inline-block; vertical-align:-3px; animation:spin .7s linear infinite;
      margin-right:.35rem;
    }
    .spinner.dark { border-color:#555; border-right-color:transparent; }
    @keyframes spin { to { transform:rotate(360deg); } }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container nav">
      <strong>GPTs Help</strong>
      <div class="right">
        <button id="openChatBtn" class="btn-nav" style="display:none" onclick="goToChat()">Open Chat</button>
        <button id="loginBtn" class="btn-nav">Log in</button>
        <button id="signupBtn" class="btn-nav primary">Sign up for free</button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <h1>Master Math & Create Content with AI</h1>
    <p>Get step-by-step math tutoring and professional AI content tools – all in one subscription. Start free today.</p>
    <div class="row" style="justify-content:center; gap:.6rem;">
      <button class="btn btn-primary" id="heroSignup">Sign up for free</button>
      <button class="btn btn-secondary" id="heroLogin">Log in</button>
    </div>
    <div class="muted" style="margin-top:.8rem;">No credit card required for the free plan.</div>
  </section>

  <!-- Features -->
  <section class="container">
    <h2>Why Choose GPTs Help?</h2>
    <div class="features">
      <div class="card"><h3>Step-by-Step Math</h3><p>Clear explanations with proofs, hints, and multiple methods.</p></div>
      <div class="card"><h3>Exam-Ready Practice</h3><p>Adaptive practice sets with instant feedback.</p></div>
      <div class="card"><h3>Content Suite</h3><p>Generate polished blog posts, essays, and scripts in minutes.</p></div>
      <div class="card"><h3>Secure & Fast</h3><p>Trusted Paystack payments. Your data stays private.</p></div>
    </div>
  </section>

  <!-- Pricing -->
  <section class="container" id="pricing">
    <h2>Choose Your Plan</h2>
    <p>Enter your email to get started. Payments processed securely with Paystack.</p>
    <input id="payerEmail" type="email" placeholder="Enter your email" style="padding:.7rem;width:300px;border-radius:8px;border:1px solid #ccc;margin:1rem 0;display:block">

    <div class="plans">
      <!-- Free -->
      <div class="plan">
        <h3>Free Plan</h3>
        <div class="price">₵0 / mo</div>
        <ul>
          <li>Up to 10 math problems / month</li>
          <li>Basic AI explanations</li>
          <li>Limited content exports</li>
        </ul>
        <button class="btn btn-secondary" onclick="goFree()">Sign Up Free</button>
        <div class="muted" style="margin-top:8px;">Already have an account? <a href="#" id="loginUnderFree">Log in</a></div>
      </div>

      <!-- Plus Monthly -->
      <div class="plan">
        <div class="badge">Popular</div>
        <h3>Plus Monthly</h3>
        <div class="price">₵99 / mo</div>
        <ul>
          <li>Unlimited math problem solving</li>
          <li>Advanced explanations & proofs</li>
          <li>Full content suite</li>
        </ul>
        <button class="btn btn-primary" onclick="subscribePlusMonthly()">Subscribe Monthly</button>
      </div>

      <!-- Pro Annual -->
      <div class="plan">
        <h3>Pro Annual</h3>
        <div class="price">₵790 / yr</div>
        <ul>
          <li>Everything in Plus</li>
          <li>Annual discount (save 34%)</li>
          <li>Team collaboration tools</li>
        </ul>
        <button class="btn btn-primary" onclick="subscribeProAnnual()">Subscribe Annually</button>
      </div>
    </div>
  </section>

  <!-- Testimonials -->
  <section class="container">
    <h2>What Our Users Say</h2>
    <div class="testimonials">
      <div class="testimonial">“I finally understood calculus limits—your hints + step-by-step solved it!”<br><strong>— Ama A., Student</strong></div>
      <div class="testimonial">“We cut blog production time by 70%. The content suite is a lifesaver.”<br><strong>— Michael T., Creator</strong></div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    &copy; <span id="year"></span> GPTs Help. All rights reserved.
  </footer>

  <!-- Log in Modal (two-step) -->
  <div class="overlay" id="loginOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <button class="close-x" id="loginClose" aria-label="Close">×</button>
      <h3 id="loginTitle">Log in to GPTs Help</h3>
      <p class="sub">Use your account email and password.</p>

      <!-- Step 1: Email -->
      <div id="loginStepEmail" class="step active">
        <label for="loginEmail">Email</label>
        <input id="loginEmail" type="email" placeholder="you@example.com" autocomplete="email" />
        <div class="err" id="loginEmailErr"></div>
        <button class="btn btn-primary" id="loginEmailContinue" type="button">Continue</button>
      </div>

      <!-- Step 2: Password -->
      <div id="loginStepPassword" class="step">
        <label>Email</label>
        <div class="inline" style="justify-content:space-between;">
          <div class="inline"><span id="loginEmailEcho" style="font-weight:600;"></span></div>
          <button class="link" id="loginChangeEmail" type="button">Change</button>
        </div>

        <label for="loginPassword" style="margin-top:8px;">Password</label>
        <div class="inline" style="width:100%;">
          <input id="loginPassword" type="password" placeholder="••••••••" autocomplete="current-password" style="flex:1;" />
          <button class="link" id="loginTogglePw" type="button" aria-label="Show password">Show</button>
        </div>

        <div class="err" id="loginErr"></div>
        <button class="btn btn-primary" id="loginSubmit" type="button">Log in</button>
        <div class="muted" style="margin-top:10px;">
          <a href="/reset-password" id="forgotLink">Forgot password?</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Sign up Modal (two-step) -->
  <div class="overlay" id="signupOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="signupTitle">
      <button class="close-x" id="signupClose" aria-label="Close">×</button>
      <h3 id="signupTitle">Create your free account</h3>
      <p class="sub">Start with the free plan. Upgrade anytime.</p>

      <!-- Step 1: Email -->
      <div id="signupStepEmail" class="step active">
        <label for="signupEmail">Email</label>
        <input id="signupEmail" type="email" placeholder="you@example.com" autocomplete="email" />
        <div class="err" id="signupEmailErr"></div>
        <button class="btn btn-primary" id="signupEmailContinue" type="button">Continue</button>
        <div class="muted" style="margin-top:10px;">Already have an account? <a href="#" id="signupGoLogin">Log in</a></div>
      </div>

      <!-- Step 2: Password -->
      <div id="signupStepPassword" class="step">
        <label>Email</label>
        <div class="inline" style="justify-content:space-between;">
          <div class="inline"><span id="signupEmailEcho" style="font-weight:600;"></span></div>
          <button class="link" id="signupChangeEmail" type="button">Change</button>
        </div>

        <label for="signupPassword" style="margin-top:8px;">Password</label>
        <input id="signupPassword" type="password" placeholder="At least 8 characters" autocomplete="new-password" />
        <label for="signupPassword2" style="margin-top:8px;">Confirm password</label>
        <input id="signupPassword2" type="password" placeholder="Re-enter password" autocomplete="new-password" />
        <div class="err" id="signupErr"></div>
        <button class="btn btn-primary" id="signupSubmit" type="button">Create account</button>
        <div class="muted" style="margin-top:10px;">By creating an account, you agree to our <a href="/terms">Terms</a> and <a href="/privacy">Privacy Policy</a>.</div>
      </div>
    </div>
  </div>

  <!-- Paystack -->
  <script src="https://js.paystack.co/v2/inline.js"></script>
  <script>
    const genRef = () => "gptshelp_" + Date.now() + "_" + Math.random().toString(36).slice(2,8);

    // Plan codes
    const PLAN_CODE_PLUS_MONTHLY = "PLN_t8tii7sryvwsxxf";
    const PLAN_CODE_PRO_ANNUAL  = "PLN_3gkd3qo1pv8rylt";

    // Optional next redirect (e.g., /index.html?next=/chat.html)
    const urlParams = new URLSearchParams(location.search);
    const NEXT_URL = urlParams.get("next") || "/chat.html";

    // Helpers to normalize backend auth responses
    function authOK(r){
      return r && (r.status === "ok" || r.status === "success") && (r.user?.email || r.email);
    }
    function authEmail(r){
      return (r && (r.user?.email || r.email)) || "";
    }

    // Load Paystack public key
    let PAYSTACK_PUBLIC_KEY = null;
    async function loadConfig() {
      try {
        const res = await fetch("/api/public-config");
        const cfg = await res.json();
        PAYSTACK_PUBLIC_KEY = cfg.paystackPublicKey || null;
      } catch {}
    }
    loadConfig();

    function requireEmail() {
      const email = document.getElementById("payerEmail").value.trim();
      if (!email) { alert("Enter your email"); return null; }
      return email;
    }

    function goToChat(){ window.location.assign("/chat.html"); }

    // ===== Shared helpers =====
    function isValidEmail(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }
    function setBtnLoading(btn, loading, finalLabel){
      if (loading) {
        btn.disabled = true;
        btn.dataset.prev = btn.textContent;
        btn.innerHTML = '<span class="spinner"></span> ' + (btn.textContent || 'Working…');
      } else {
        btn.disabled = false;
        btn.textContent = finalLabel || btn.dataset.prev || btn.textContent;
      }
    }

    // ===== API wrappers =====
    async function apiLogin(email, password){
      const r = await fetch("/api/login", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        credentials:"include",
        body: JSON.stringify({ email, password })
      });
      return r.json();
    }

    async function apiSignupFree(email, password){
      // Server may ignore password; we send it if you support it.
      const r = await fetch("/api/signup-free", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        credentials:"include",
        body: JSON.stringify({ email, password })
      });
      return r.json();
    }

    async function checkSession() {
      try {
        const me = await fetch("/api/me", { credentials: "include" }).then(r=>r.json());
        if (me.status === "ok" && me.user?.email) {
          document.getElementById("openChatBtn").style.display = "inline-block";
          document.getElementById("loginBtn").textContent = "Switch account";
          document.getElementById("signupBtn").textContent = "New account";
        }
      } catch {}
    }

    // ===== Free signup via pricing box (kept for convenience) =====
    async function goFree() {
      const email = requireEmail(); if (!email) return;
      try{
        const res = await apiSignupFree(email, null);
        if (authOK(res)) {
          localStorage.setItem("userEmail", authEmail(res));
          setTimeout(()=>window.location.assign(NEXT_URL), 150);
        } else {
          alert("Error: " + (res?.message || "Signup failed"));
        }
      }catch{
        alert("Network error. Please try again.");
      }
    }

    // ===== Paystack subscriptions =====
    function subscribeWithPlan(planCode, label) {
      const email = requireEmail(); if (!email) return;
      if (!PAYSTACK_PUBLIC_KEY) { alert("Payment key not loaded."); return; }

      const popup = new PaystackPop();
      popup.newTransaction({
        key: PAYSTACK_PUBLIC_KEY,
        email,
        currency: "GHS",
        plan: planCode,
        reference: genRef(),
        callback: (response) => {
          fetch("/api/paystack/verify", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            credentials: "include",
            body: JSON.stringify({ reference: response.reference })
          })
          .then(r => r.json())
          .then(r => {
            if (r.status === "success" || r.status === "ok") {
              alert(label + " subscription activated!");
              localStorage.setItem("userEmail", email);
              window.location.href = NEXT_URL;
            } else {
              alert("Verification failed. Ref: " + response.reference);
            }
          })
          .catch(()=> alert("Verification request failed."));
        },
        onCancel: () => alert("Payment cancelled.")
      });
    }
    function subscribePlusMonthly() { subscribeWithPlan(PLAN_CODE_PLUS_MONTHLY, "Plus Monthly"); }
    function subscribeProAnnual() { subscribeWithPlan(PLAN_CODE_PRO_ANNUAL, "Pro Annual"); }

    // ===== Log in modal logic =====
    const loginOverlay = document.getElementById("loginOverlay");
    const loginBtn = document.getElementById("loginBtn");
    const heroLogin = document.getElementById("heroLogin");
    const loginClose = document.getElementById("loginClose");

    const loginStepEmail = document.getElementById("loginStepEmail");
    const loginStepPassword = document.getElementById("loginStepPassword");
    const loginEmail = document.getElementById("loginEmail");
    const loginEmailErr = document.getElementById("loginEmailErr");
    const loginEmailContinue = document.getElementById("loginEmailContinue");

    const loginEmailEcho = document.getElementById("loginEmailEcho");
    const loginChangeEmail = document.getElementById("loginChangeEmail");
    const loginPassword = document.getElementById("loginPassword");
    const loginTogglePw = document.getElementById("loginTogglePw");
    const loginErr = document.getElementById("loginErr");
    const loginSubmit = document.getElementById("loginSubmit");

    function openLogin(){
      loginEmailErr.textContent = '';
      loginErr.textContent = '';
      loginOverlay.classList.add("open");
      loginOverlay.setAttribute("aria-hidden","false");
      loginStepEmail.classList.add("active");
      loginStepPassword.classList.remove("active");
      setTimeout(()=> loginEmail.focus(), 20);
    }
    function closeLogin(){
      loginOverlay.classList.remove("open");
      loginOverlay.setAttribute("aria-hidden","true");
    }
    function handleLoginEmailContinue(){
      const e = loginEmail.value.trim();
      loginEmailErr.textContent = '';
      if (!isValidEmail(e)) { loginEmailErr.textContent = "Enter a valid email."; return; }
      loginEmailEcho.textContent = e;
      loginStepEmail.classList.remove("active");
      loginStepPassword.classList.add("active");
      setTimeout(()=> loginPassword.focus(), 20);
    }
    function handleLoginSubmit(){
      const email = loginEmailEcho.textContent.trim() || loginEmail.value.trim();
      const pw = loginPassword.value;
      if (!isValidEmail(email)) { loginStepPassword.classList.remove("active"); loginStepEmail.classList.add("active"); loginEmailErr.textContent = "Enter a valid email."; return; }
      if (!pw) { loginErr.textContent = "Enter your password."; return; }
      setBtnLoading(loginSubmit, true, "Log in");
      apiLogin(email, pw)
        .then(r=>{
          if (authOK(r)) {
            localStorage.setItem("userEmail", authEmail(r));
            window.location.replace(NEXT_URL);
          } else {
            loginErr.textContent = r?.message || "Invalid email or password.";
          }
        })
        .catch(()=> loginErr.textContent = "Could not log in. Check your connection.")
        .finally(()=> setBtnLoading(loginSubmit, false, "Log in"));
    }
    loginBtn.addEventListener('click', openLogin);
    heroLogin.addEventListener('click', openLogin);
    loginClose.addEventListener('click', closeLogin);
    loginOverlay.addEventListener('click', (e)=>{ if (e.target === loginOverlay) closeLogin(); });
    document.addEventListener('keydown', (e)=>{ if(e.key === "Escape" && loginOverlay.classList.contains("open")) closeLogin(); });

    loginEmailContinue.addEventListener('click', handleLoginEmailContinue);
    loginEmail.addEventListener('keydown', (e)=>{ if(e.key==='Enter') handleLoginEmailContinue(); });

    loginChangeEmail.addEventListener('click', ()=>{
      loginStepPassword.classList.remove("active");
      loginStepEmail.classList.add("active");
      setTimeout(()=> loginEmail.focus(), 20);
    });
    loginTogglePw.addEventListener('click', ()=>{
      const isPw = loginPassword.type === 'password';
      loginPassword.type = isPw ? 'text' : 'password';
      loginTogglePw.textContent = isPw ? 'Hide' : 'Show';
      loginPassword.focus();
    });
    loginSubmit.addEventListener('click', handleLoginSubmit);
    loginPassword.addEventListener('keydown', (e)=>{ if(e.key==='Enter') handleLoginSubmit(); });

    // ===== Sign up modal logic =====
    const signupOverlay = document.getElementById("signupOverlay");
    const signupBtn = document.getElementById("signupBtn");
    const heroSignup = document.getElementById("heroSignup");
    const signupClose = document.getElementById("signupClose");

    const signupStepEmail = document.getElementById("signupStepEmail");
    const signupStepPassword = document.getElementById("signupStepPassword");
    const signupEmail = document.getElementById("signupEmail");
    const signupEmailErr = document.getElementById("signupEmailErr");
    const signupEmailContinue = document.getElementById("signupEmailContinue");

    const signupEmailEcho = document.getElementById("signupEmailEcho");
    const signupChangeEmail = document.getElementById("signupChangeEmail");
    const signupPassword = document.getElementById("signupPassword");
    const signupPassword2 = document.getElementById("signupPassword2");
    const signupErr = document.getElementById("signupErr");
    const signupSubmit = document.getElementById("signupSubmit");
    const signupGoLogin = document.getElementById("signupGoLogin");

    function openSignup(){
      signupEmailErr.textContent = '';
      signupErr.textContent = '';
      signupOverlay.classList.add("open");
      signupOverlay.setAttribute("aria-hidden","false");
      signupStepEmail.classList.add("active");
      signupStepPassword.classList.remove("active");
      setTimeout(()=> signupEmail.focus(), 20);
    }
    function closeSignup(){
      signupOverlay.classList.remove("open");
      signupOverlay.setAttribute("aria-hidden","true");
    }
    function handleSignupEmailContinue(){
      const e = signupEmail.value.trim();
      signupEmailErr.textContent = '';
      if (!isValidEmail(e)) { signupEmailErr.textContent = "Enter a valid email."; return; }
      signupEmailEcho.textContent = e;
      signupStepEmail.classList.remove("active");
      signupStepPassword.classList.add("active");
      setTimeout(()=> signupPassword.focus(), 20);
    }
    function passwordOk(p){ return typeof p === 'string' && p.length >= 8; }

    // shared free-signup call; sets cookie
    function signupFree(email, password){
      return apiSignupFree(email, password);
    }

    function handleSignupSubmit(){
      signupErr.textContent = '';
      const email = signupEmailEcho.textContent.trim() || signupEmail.value.trim();
      const p1 = signupPassword.value;
      const p2 = signupPassword2.value;
      if (!isValidEmail(email)) { signupStepPassword.classList.remove("active"); signupStepEmail.classList.add("active"); signupEmailErr.textContent = "Enter a valid email."; return; }
      if (!passwordOk(p1)) { signupErr.textContent = "Password must be at least 8 characters."; return; }
      if (p1 !== p2) { signupErr.textContent = "Passwords do not match."; return; }
      setBtnLoading(signupSubmit, true, "Create account");
      signupFree(email, p1)
        .then(r=>{
          if (authOK(r)) {
            localStorage.setItem("userEmail", authEmail(r));
            window.location.replace(NEXT_URL);
          } else {
            signupErr.textContent = r?.message || "Sign up failed. Try again.";
          }
        })
        .catch(()=> signupErr.textContent = "Network error. Please try again.")
        .finally(()=> setBtnLoading(signupSubmit, false, "Create account"));
    }

    signupBtn.addEventListener('click', openSignup);
    heroSignup.addEventListener('click', openSignup);
    signupClose.addEventListener('click', closeSignup);
    signupOverlay.addEventListener('click', (e)=>{ if (e.target === signupOverlay) closeSignup(); });
    document.addEventListener('keydown', (e)=>{ if(e.key === "Escape" && signupOverlay.classList.contains("open")) closeSignup(); });

    signupEmailContinue.addEventListener('click', handleSignupEmailContinue);
    signupEmail.addEventListener('keydown', (e)=>{ if(e.key==='Enter') handleSignupEmailContinue(); });

    signupChangeEmail.addEventListener('click', ()=>{
      signupStepPassword.classList.remove("active");
      signupStepEmail.classList.add("active");
      setTimeout(()=> signupEmail.focus(), 20);
    });
    signupSubmit.addEventListener('click', handleSignupSubmit);
    signupPassword2.addEventListener('keydown', (e)=>{ if(e.key==='Enter') handleSignupSubmit(); });

    signupGoLogin.addEventListener('click', (e)=>{ e.preventDefault(); closeSignup(); openLogin(); });

    // Open login from pricing free card link
    document.getElementById("loginUnderFree").addEventListener('click', (e)=>{ e.preventDefault(); openLogin(); });

    document.getElementById("year").textContent = new Date().getFullYear();
    checkSession();
  </script>
</body>
</html>

