<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GPTs Help — All-in-One AI Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --primary:#4e54c8;
      --secondary:#6a11cb;
      --bg:#0e0f13; --text:#e7eaf1; --muted:#a6afbf;
      --panel:#13141a; --panel2:#171926; --border:#232634;
      --brand:#7c5cff; --brand2:#5a7bff; --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
      background: linear-gradient(135deg, var(--secondary), var(--primary));
      background-attachment: fixed;
    }
    .container{max-width:1100px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
    .logo{font-weight:700;letter-spacing:.2px}
    .btn-link{background:none;border:0;color:#fff;font-weight:600;cursor:pointer}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      height:44px;padding:0 18px;border-radius:12px;border:0;cursor:pointer;
      font-weight:700;color:#fff;background:linear-gradient(135deg,var(--brand),var(--brand2));
    }
    .btn.secondary{background:#ffffff1a;border:1px solid #ffffff2a}
    .btn.block{width:100%}
    .card{
      background:#ffffff10;backdrop-filter:saturate(160%) blur(6px);
      border:1px solid #ffffff2a;border-radius:16px;padding:22px;
    }
    .hero{display:grid;gap:14px;justify-items:center;text-align:center;margin:40px 0}
    .hero h1{margin:0;font-size:40px;line-height:1.1}
    .hero p{margin:0;color:#f0f3ff;opacity:.95}
    .price{display:inline-block;background:#fff;color:var(--primary);font-weight:800;border-radius:999px;padding:10px 20px;margin-top:6px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;margin-top:26px}
    .feature{background:#0e0f13cc;border:1px solid #ffffff14;border-radius:14px;padding:16px}
    .feature h3{margin:0 0 6px 0}

    /* Auth drawer */
    .drawer{
      max-width:520px;margin:22px auto;background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:20px;
      display:none;
    }
    .drawer.show{display:block}
    .row{display:grid;gap:8px;margin-top:10px}
    label{font-size:13px;color:#cfd5e3}
    input[type="email"]{
      width:100%;height:44px;border-radius:10px;border:1px solid var(--border);
      background:var(--panel2);color:var(--text);padding:0 12px;font-size:14px;outline:none;
    }
    .hint{color:var(--muted);font-size:12px;margin-top:6px}
    .status{margin-top:12px;font-size:13px}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .danger{color:var(--danger)}
    .actions{display:grid;grid-template-columns:1fr;gap:10px;margin-top:14px}
    .sep{margin:14px 0;border-top:1px solid var(--border)}
    .center{text-align:center}
    a.muted{color:#cfd5e3}
    .mini{font-size:12px;color:#aab1c2}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">GPTs Help</div>
      <div>
        <button class="btn-link" id="openAuth">Log In</button>
        <a class="btn" id="goChatBtn" href="/chat.html">Go to Chat</a>
      </div>
    </header>

    <section class="hero">
      <h1>One subscription. All the AI help you need.</h1>
      <p>Math GPT tutoring + ContentGPT creation — in one place.</p>
      <div class="price">$9.99 / month</div>
      <div>
        <button class="btn" id="getStarted">Get Started</button>
      </div>
    </section>

    <div class="grid">
      <div class="feature">
        <h3>Math GPT</h3>
        <div>Step-by-step tutoring, photo solve, adaptive practice, diagnostic → personalized plan.</div>
      </div>
      <div class="feature">
        <h3>ContentGPT</h3>
        <div>Multi-format generation: blog → LinkedIn → thread → email → YouTube/TikTok, with export to Word/PDF/PPTX/HTML/MD.</div>
      </div>
    </div>

    <!-- Auth / Subscribe Drawer -->
    <div class="drawer" id="authDrawer">
      <h2 style="margin-top:0">Access your tools</h2>
      <div class="row">
        <label for="email">Your email</label>
        <input id="email" type="email" placeholder="you@example.com" />
        <div class="mini">We store this locally to open your chats and verify subscription.</div>
      </div>
      <div class="actions">
        <button class="btn secondary" id="saveEmailBtn">Save email</button>
        <button class="btn" id="subscribeBtn">Subscribe — $9.99 / month</button>
        <button class="btn secondary" id="goChatBtn2">Go to Chat</button>
      </div>
      <div class="sep"></div>
      <div class="row">
        <div class="status" id="statusMsg"></div>
        <div class="mini">Already paid? Click “Go to Chat”. We’ll confirm your subscription automatically.</div>
      </div>
      <div class="sep"></div>
      <div class="center">
        <button class="btn-link" id="devEnable">Dev: quick enable (debug)</button>
      </div>
    </div>

    <div class="center" style="margin-top:30px">
      <a class="muted" href="/chat.html">Open chat directly</a>
    </div>
  </div>

  <script>
    // ===== Helpers =====
    const $ = (id)=>document.getElementById(id);
    function setStatus(msg, cls=''){ const s=$('statusMsg'); s.className='status '+cls; s.textContent=msg; }
    function getEmailInput(){
      const v = $('email').value.trim();
      if (!v) { setStatus('Please enter your email.', 'warn'); return null; }
      return v;
    }
    async function checkSubscribed(email){
      try{
        const r = await fetch('/api/user/'+encodeURIComponent(email));
        const j = await r.json();
        return !!j.subscribed;
      }catch{ return false; }
    }
    function requireEmail(){
      let email = localStorage.getItem('userEmail');
      if (!email){
        email = getEmailInput();
        if (!email) return null;
        localStorage.setItem('userEmail', email);
      }
      return email;
    }

    // ===== UI wiring =====
    const drawer = $('authDrawer');
    $('openAuth').onclick = () => { drawer.classList.add('show'); const e=localStorage.getItem('userEmail'); if(e) $('email').value=e; };
    $('getStarted').onclick = () => { drawer.classList.add('show'); const e=localStorage.getItem('userEmail'); if(e) $('email').value=e; };
    $('saveEmailBtn').onclick = () => {
      const v = getEmailInput(); if(!v) return;
      localStorage.setItem('userEmail', v);
      setStatus('Email saved. You can subscribe or go to chat.', 'ok');
    };

    // Go to Chat (top-right)
    $('goChatBtn').addEventListener('click', async (e) => {
      e.preventDefault();
      const email = requireEmail(); if(!email){ drawer.classList.add('show'); return; }
      const ok = await checkSubscribed(email);
      if (ok) window.location.assign('/chat.html');
      else {
        setStatus('Subscription not active yet. Click Subscribe to start your plan.', 'warn');
        drawer.classList.add('show');
      }
    });

    // Go to Chat (drawer)
    $('goChatBtn2').addEventListener('click', async (e) => {
      e.preventDefault();
      const email = requireEmail(); if(!email) return;
      const ok = await checkSubscribed(email);
      if (ok) window.location.assign('/chat.html');
      else setStatus('Subscription not active. Please subscribe first.', 'warn');
    });

    // Subscribe with Paystack (server builds callback for current host)
    $('subscribeBtn').onclick = async () => {
      const email = requireEmail(); if(!email) return;
      setStatus('Initializing payment…');
      try{
        const r = await fetch('/api/create-subscription', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ email, amount: 9.99 })
        });
        const j = await r.json();
        if (!r.ok || !j.authorization_url) throw new Error(j.error || 'Failed to init payment');
        // IMPORTANT: email must be in localStorage BEFORE we leave for checkout
        localStorage.setItem('userEmail', email);
        window.location.assign(j.authorization_url);
      }catch(err){
        console.error(err);
        setStatus('Payment initialization failed. Please try again.', 'danger');
      }
    };

    // Developer quick-enable (marks subscribed on server)
    $('devEnable').onclick = async () => {
      const email = requireEmail(); if(!email) return;
      try{
        const r = await fetch('/api/debug-login', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ email })
        });
        if (!r.ok) throw new Error('debug error');
        setStatus('Access enabled for development. Opening chat…', 'ok');
        setTimeout(()=> window.location.assign('/chat.html'), 600);
      }catch{
        setStatus('Debug enable failed.', 'danger');
      }
    };

    // Prefill email if known
    const saved = localStorage.getItem('userEmail');
    if (saved) $('email').value = saved;
  </script>
</body>
</html>
