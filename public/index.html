<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GPTs Help — Account</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{--primary:#4e54c8;--secondary:#6a11cb;--light:#f8f9fa;--dark:#343a40}
    *{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Inter,sans-serif}
    body{background:linear-gradient(135deg,var(--secondary) 0%,var(--primary) 100%);min-height:100vh;color:#222;padding:20px}
    .container{max-width:1100px;margin:0 auto}
    header{display:flex;justify-content:space-between;align-items:center;margin:10px 0 24px}
    .logo{color:#fff;font-weight:800;font-size:1.6rem}
    .nav button{background:none;border:none;color:#fff;font-weight:600;margin-left:16px;cursor:pointer}
    .hero{color:#fff;text-align:center;margin:40px 0}
    .hero h1{font-size:2.4rem;margin-bottom:10px}
    .price{display:inline-block;background:#fff;color:#4e54c8;font-weight:800;border-radius:999px;padding:10px 18px;margin:14px 0}
    .grid{display:grid;gap:20px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));margin-top:28px}
    .card{background:#fff;border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,.12);padding:20px}
    .gpt-icon{height:110px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:2rem;color:#fff;margin-bottom:12px}
    .math{background:linear-gradient(135deg,#4e54c8,#6a11cb)} .content{background:linear-gradient(135deg,#4ECDC4,#6de0d9)}
    .btn{background:#4e54c8;color:#fff;border:none;border-radius:10px;padding:12px 18px;font-weight:700;cursor:pointer}
    .btn.secondary{background:#222}
    .center{text-align:center}
    .stack{display:grid;gap:12px}
    .field label{font-weight:700;margin-bottom:6px;display:block}
    .field input{width:100%;padding:12px;border-radius:10px;border:1px solid #e5e7eb}
    .muted{color:#666;font-size:.9rem}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">GPTs Help</div>
      <div class="nav">
        <button id="nav-chat">Chat</button>
        <button id="nav-signout" class="hidden">Sign Out</button>
      </div>
    </header>

    <section class="hero">
      <h1>One Subscription. All AI Tools.</h1>
      <p>Unlimited access to specialized AI assistants</p>
      <div class="price">$9.99 / month</div>
      <div class="center" style="margin-top:14px;">
        <button class="btn" id="cta-get-started">Get Started</button>
      </div>
    </section>

    <section class="grid">
      <div class="card">
        <div class="gpt-icon math"><i class="fas fa-square-root-alt"></i></div>
        <h3>Math GPT</h3>
        <p>Your patient AI math tutor—step-by-step help from arithmetic to calculus.</p>
      </div>
      <div class="card">
        <div class="gpt-icon content"><i class="fas fa-pen-fancy"></i></div>
        <h3>Content GPT</h3>
        <p>Create engaging content for posts, blogs, and business—fast.</p>
      </div>
    </section>

    <section class="card" id="account" style="max-width:520px;margin:28px auto 0;">
      <h2>Subscribe / Sign In</h2>
      <p class="muted">Use your email to subscribe and unlock chat.</p>
      <div class="stack" style="margin-top:12px">
        <div class="field">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="you@example.com">
        </div>
        <div class="stack" style="grid-template-columns:1fr 1fr">
          <button class="btn" id="btn-subscribe">$9.99/month — Subscribe</button>
          <button class="btn secondary" id="btn-refresh">I’ve Paid — Refresh Access</button>
        </div>
        <p class="muted">7-day money-back guarantee</p>
        <hr/>
        <div class="stack" style="grid-template-columns:1fr 1fr">
          <button class="btn secondary" id="btn-debug">Debug Login (Testing)</button>
          <button class="btn" id="btn-go-chat">Go to Chat</button>
        </div>
        <small class="muted">Debug is for testing only—remove in production.</small>
        <div id="sub-status" class="muted" style="margin-top:6px">Status: (not checked)</div>
      </div>
    </section>
  </div>

  <script>
    const API_BASE = 'https://gpts-help-production.up.railway.app';
    const PLAN = { amount: 9.99, currency: 'USD' };

    const $ = s => document.querySelector(s);
    const saveEmail = e => localStorage.setItem('gpts_email', e);
    const getEmail = () => localStorage.getItem('gpts_email') || '';
    const signedIn = () => !!getEmail();

    async function checkSubscription(email){
      if(!email) return { subscribed:false };
      const r = await fetch(`${API_BASE}/api/user/${encodeURIComponent(email)}`);
      return r.ok ? r.json() : { subscribed:false };
    }
    async function createSubscription(email){
      const r = await fetch(`${API_BASE}/api/create-subscription`, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ email, amount: PLAN.amount, currency: PLAN.currency })
      });
      const data = await r.json();
      if(!r.ok) throw new Error(data.error || 'Payment init failed');
      if(!data.authorization_url) throw new Error('No Paystack URL returned');
      window.location.href = data.authorization_url;
    }
    async function debugLogin(email){
      const r = await fetch(`${API_BASE}/api/debug-login`, {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ email })
      });
      if(!r.ok) throw new Error('Debug failed');
      return r.json();
    }

    async function goChatIfAllowed(){
      const email = getEmail() || $('#email').value.trim();
      if(!email){ alert('Enter your email first.'); $('#email').focus(); return; }
      saveEmail(email);
      const sub = await checkSubscription(email);
      if(sub.subscribed) window.location.href = 'chat.html';
      else { $('#sub-status').textContent = 'Status: NOT ACTIVE'; alert('No active subscription yet. If you just paid, click “Refresh Access”.'); }
    }

    // Nav actions
    $('#nav-chat').onclick = goChatIfAllowed;
    $('#nav-signout').onclick = () => { localStorage.removeItem('gpts_email'); $('#nav-signout').classList.add('hidden'); alert('Signed out.'); };
    $('#cta-get-started').onclick = () => $('#email').focus();

    // Account actions
    $('#btn-subscribe').onclick = async () => {
      const email = $('#email').value.trim(); if(!email) return alert('Enter your email.');
      saveEmail(email);
      try{ $('#btn-subscribe').disabled = true; await createSubscription(email); }
      catch(e){ alert(e.message); }
      finally{ $('#btn-subscribe').disabled = false; }
    };

    $('#btn-refresh').onclick = async () => {
      const email = $('#email').value.trim() || getEmail(); if(!email) return alert('Enter your email.');
      saveEmail(email);
      const sub = await checkSubscription(email);
      $('#sub-status').textContent = sub.subscribed ? 'Status: ACTIVE' : 'Status: NOT ACTIVE';
      if(sub.subscribed){ $('#nav-signout').classList.remove('hidden'); alert('Access active—click Chat to start.'); }
    };

    $('#btn-debug').onclick = async () => {
      const email = $('#email').value.trim(); if(!email) return alert('Enter your email.'); saveEmail(email);
      try{ await debugLogin(email); $('#sub-status').textContent = 'Status: ACTIVE (debug)'; $('#nav-signout').classList.remove('hidden'); alert('Marked subscribed for testing. Click Chat.'); }
      catch(e){ alert('Debug failed: '+e.message); }
    };

    $('#btn-go-chat').onclick = goChatIfAllowed;

    // Init
    (async function init(){
      const saved = getEmail();
      if(saved){ $('#email').value = saved; $('#nav-signout').classList.remove('hidden'); const sub=await checkSubscription(saved); $('#sub-status').textContent = sub.subscribed?'Status: ACTIVE':'Status: NOT ACTIVE'; }
    })();
  </script>
</body>
</html>
