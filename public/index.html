<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>GPTs Help — Snap → Solve. Master Math with AI.</title>
  <meta name="description" content="Upload a math problem and get a clear, step-by-step solution instantly. MathGPT helps students, parents, and teachers master math through AI-powered explanations. Try it free.">
  <link rel="canonical" href="https://gptshelp.online/" />

  <!-- Social -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Snap → Solve. Master Math with AI.">
  <meta property="og:description" content="Upload a math problem and get step-by-step AI-powered solutions. Free to try — upgrade for unlimited photo solves.">
  <meta property="og:url" content="https://gptshelp.online/">
  <meta property="og:image" content="https://gptshelp.online/static/brand/cover.jpg">
  <meta property="og:site_name" content="GPTs Help">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="GPTs Help — Master Math with AI">
  <meta name="twitter:description" content="Snap → Solve. Instantly get math solutions powered by AI. Free to try.">
  <meta name="twitter:image" content="https://gptshelp.online/static/brand/cover.jpg">

  <!-- PWA / Icons -->
  <link rel="icon" href="/static/brand/favicon.ico" />
  <link rel="apple-touch-icon" href="/static/brand/logo-192.png" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#6f42c1" />

  <!-- Performance hints -->
  <link rel="preconnect" href="https://api.paystack.co" crossorigin>
  <link rel="preconnect" href="https://js.paystack.co" crossorigin>

  <style>
    :root{
      --brand:#6f42c1;--accent:#ffc107;--bg:#f8f9fa;--text:#212529;--muted:#6c757d;
      --panel:#fff;--border:#eee;--shadow:0 16px 36px rgba(0,0,0,.08);
      --error:#dc3545;--ok:#198754
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--text);background:var(--bg)}
    a{color:var(--brand);text-decoration:none}

    header{background:#fff;border-bottom:1px solid #eee}
    .nav{max-width:1200px;margin:0 auto;padding:1rem 2rem;display:flex;align-items:center;justify-content:space-between}
    .brand{font-weight:800;letter-spacing:.2px;color:var(--brand);font-size:1.2rem}
    .nav-right{display:flex;gap:.5rem;align-items:center}
    .btn-nav{border:1px solid var(--border);background:#fff;color:var(--brand);padding:.55rem .9rem;border-radius:10px;cursor:pointer;font-weight:600}
    .btn-nav.primary{background:var(--brand);color:#fff;border-color:transparent}

    .hero{background:linear-gradient(135deg,var(--brand),#9c6fff);color:#fff;text-align:center;padding:5rem 2rem}
    .hero h1{font-size:clamp(2rem,4vw,3rem);margin-bottom:1rem}
    .hero p{font-size:1.1rem;max-width:720px;margin:0 auto 0;opacity:.98}

    .container{max-width:1200px;margin:0 auto;padding:2rem}
    h2{margin:.5rem 0}

    .features{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1.5rem;margin-top:2rem}
    .card{background:#fff;border:1px solid #eee;border-radius:12px;padding:1.5rem;box-shadow:var(--shadow)}

    .plans{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem;margin-top:2rem}
    .plan{background:#fff;border:1px solid #eee;border-radius:14px;padding:2rem;position:relative;text-align:center;box-shadow:var(--shadow)}
    .plan h3{margin-bottom:.5rem}
    .price{font-size:2rem;color:var(--brand);margin:.5rem 0 1rem}
    .plan ul{list-style:none;padding:0;margin:1rem 0;color:var(--muted);text-align:left}
    .plan li{margin:.35rem 0}
    .badge{position:absolute;top:12px;right:12px;background:var(--brand);color:#fff;font-size:.75rem;padding:.25rem .5rem;border-radius:999px}

    .demo{margin-top:2rem;display:grid;grid-template-columns:1.2fr 1fr;gap:1.5rem}
    @media (max-width:960px){.demo{grid-template-columns:1fr}}
    .demo-left,.demo-right{background:#fff;border:1px solid #eee;border-radius:14px;padding:1.25rem;box-shadow:var(--shadow)}
    .drop{border:2px dashed #ddd;border-radius:12px;padding:1.25rem;text-align:center;color:#555}
    .drop.drag{border-color:#c5b3f7;background:#faf6ff}
    .drop input{display:none}
    .small{color:var(--muted);font-size:.9rem}
    .btn{padding:.85rem 1.2rem;font-weight:700;border:none;border-radius:10px;cursor:pointer}
    .btn-primary{background:var(--accent);color:#000}
    .btn-secondary{background:#fff;color:var(--brand);border:1px solid var(--border)}
    .demo-actions{display:flex;gap:.6rem;justify-content:center;margin-top:.75rem}
    .preview{margin-top:1rem;display:flex;gap:1rem;flex-wrap:wrap;justify-content:center}
    .preview img{max-width:220px;border-radius:10px;border:1px solid #eee}
    .result{background:#0f1117;color:#e7eaf1;border-radius:12px;padding:1rem;border:1px solid #222;margin-top:1rem;min-height:120px;white-space:pre-wrap}
    .spinner{width:16px;height:16px;border:2px solid #fff;border-right-color:transparent;border-radius:50%;display:inline-block;vertical-align:-3px;animation:spin .7s linear infinite;margin-right:.35rem}
    .spinner.dark{border-color:#555;border-right-color:transparent}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Overlays / modals */
    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.45);z-index:1000}
    .overlay.open{display:flex}
    .modal{width:min(520px,92vw);background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:18px;box-shadow:var(--shadow)}
    .modal h3{margin:.25rem 0 4px;font-size:1.15rem}
    .modal p.sub{color:var(--muted);margin:0 0 12px;font-size:.95rem}
    .row{display:flex;gap:.6rem}
    label{display:block;font-size:.9rem;color:var(--muted);margin:.35rem 0 .35rem}
    input[type="email"],input[type="password"]{width:100%;padding:.75rem .9rem;border:1px solid #ddd;border-radius:10px;font-size:1rem}
    .modal .btn{width:100%}
    .close-x{border:0;background:transparent;color:#999;font-size:20px;cursor:pointer;float:right}
    .err{color:var(--error);font-size:.9rem;min-height:18px;margin-top:6px}
    .muted{color:var(--muted);font-size:.9rem;margin-top:8px}
    .step{display:none}.step.active{display:block}
    .inline{display:flex;align-items:center;gap:.5rem}
    .link{color:var(--brand);background:none;border:0;padding:0;cursor:pointer;font-weight:600}
    .verify-note{background:#fff3cd;border:1px solid #ffe69c;color:#664d03;padding:10px;border-radius:8px;margin:8px 0;font-size:.95rem}
  </style>

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"Organization","name":"GPTs Help","url":"https://gptshelp.online/","logo":"https://gptshelp.online/static/brand/logo-192.png"}
  </script>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="nav" role="navigation" aria-label="Primary">
      <a class="brand" href="/" aria-label="Home">GPTs Help</a>
      <div class="nav-right">
        <a class="btn-nav" href="/overview/" aria-label="Overview">Overview</a>
        <a class="btn-nav" href="/pricing/" aria-label="Pricing">Pricing</a>
        <a class="btn-nav" href="/download/" aria-label="Download">Download</a>
        <button id="openChatBtn" class="btn-nav" style="display:none">Open Chat</button>
        <button id="loginBtn" class="btn-nav">Log in</button>
        <button id="signupBtn" class="btn-nav primary">Sign up for free</button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <h1>Snap → Solve. Master Math with AI.</h1>
    <p>Upload a math problem and get a step-by-step solution. Try it free — then unlock unlimited photo solves.</p>
  </section>

  <!-- Pricing Plans -->
  <section class="container" id="pricing">
    <h2>Choose Your Plan</h2>
    <div class="plans">
      <div class="plan">
        <h3>Free Plan</h3>
        <div class="price">₵0 / mo</div>
        <ul>
          <li><strong>2 Photo Solves</strong></li>
          <li>Basic step-by-step answers</li>
          <li>Try before you buy</li>
        </ul>
        <button class="btn btn-secondary" id="startFreeBtn">Start free</button>
      </div>

      <div class="plan">
        <div class="badge">Popular</div>
        <h3>Plus Monthly</h3>
        <div class="price" id="pricePlus">—</div>
        <ul>
          <li><strong>Unlimited Photo Solves</strong></li>
          <li>Advanced explanations &amp; proofs</li>
          <li>Priority processing</li>
        </ul>
        <button class="btn btn-primary" id="plusMonthlyBtn">Subscribe Monthly</button>
      </div>

      <div class="plan">
        <h3>Pro Annual</h3>
        <div class="price" id="pricePro">—</div>
        <ul>
          <li><strong>Unlimited Photo Solves</strong></li>
          <li>Annual discount (save 34%)</li>
          <li>Team sharing &amp; exports</li>
        </ul>
        <button class="btn btn-primary" id="proAnnualBtn">Subscribe Annually</button>
      </div>
    </div>
  </section>

  <!-- Simple demo & testimonials omitted for brevity -->

  <!-- Footer -->
  <footer style="text-align:center;padding:2rem;color:var(--muted);margin-top:3rem;border-top:1px solid #eee">
    &copy; <span id="year"></span> GPTs Help. All rights reserved. ·
    <a href="/support/">Support</a> · <a href="/pricing/">Pricing</a>
  </footer>

  <!-- ===== Auth Modals ===== -->
  <!-- Login -->
  <div id="loginOverlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <button id="loginClose" class="close-x" aria-label="Close">×</button>
      <h3 id="loginTitle">Log in</h3>
      <p class="sub">Welcome back! Enter your email to continue.</p>

      <div id="loginStepEmail" class="step active">
        <label>Email</label>
        <input id="loginEmail" type="email" placeholder="you@email.com" />
        <div id="loginEmailErr" class="err"></div>
        <button id="loginEmailContinue" class="btn btn-primary" style="width:100%">Continue</button>
      </div>

      <div id="loginStepPassword" class="step">
        <div class="inline" style="justify-content:space-between">
          <div><strong id="loginEmailEcho"></strong> <button id="loginChangeEmail" class="link">Change</button></div>
          <button id="forgotLink" class="link">Forgot?</button>
        </div>
        <label>Password</label>
        <input id="loginPassword" type="password" placeholder="••••••••" />
        <div id="loginErr" class="err"></div>
        <button id="loginSubmit" class="btn btn-primary">Log in</button>
        <p class="muted">No account? <a id="loginGoSignup" href="#">Sign up</a></p>
      </div>
    </div>
  </div>

  <!-- Signup -->
  <div id="signupOverlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="signupTitle">
      <button id="signupClose" class="close-x" aria-label="Close">×</button>
      <h3 id="signupTitle">Create your account</h3>
      <p class="sub">Try GPTs Help free. Verify email to start.</p>

      <div id="signupStepEmail" class="step active">
        <label>Email</label>
        <input id="signupEmail" type="email" placeholder="you@email.com" />
        <div id="signupEmailErr" class="err"></div>
        <button id="signupEmailContinue" class="btn btn-primary" style="width:100%">Continue</button>
      </div>

      <div id="signupStepPassword" class="step">
        <div class="inline" style="justify-content:space-between">
          <div><strong id="signupEmailEcho"></strong> <button id="signupChangeEmail" class="link">Change</button></div>
        </div>
        <label>Password</label>
        <input id="signupPassword" type="password" placeholder="At least 8 characters" />
        <label>Confirm password</label>
        <input id="signupPassword2" type="password" placeholder="Repeat password" />
        <div id="signupErr" class="err"></div>
        <button id="signupSubmit" class="btn btn-primary">Create account</button>
        <div id="verifyInfo" class="verify-note" style="display:none">We’ve sent a verification link to your email.</div>
        <div class="inline" style="justify-content:space-between;margin-top:.5rem">
          <span class="muted">Already have an account?</span>
          <button id="signupGoLogin" class="link">Log in</button>
        </div>
        <div class="inline" style="margin-top:.5rem">
          <button id="resendVerifyBtn" class="btn btn-secondary" type="button">Resend email</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Simple “paywall” overlay (reuse server-init too) -->
  <div id="paywallOverlay" class="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="paywallTitle">
      <button id="paywallClose" class="close-x" aria-label="Close">×</button>
      <h3 id="paywallTitle">Upgrade for unlimited solves</h3>
      <div class="row" style="margin-top:8px">
        <button id="paywallMonthly" class="btn btn-primary">Plus Monthly</button>
        <button id="paywallAnnual" class="btn btn-secondary">Pro Annual</button>
      </div>
    </div>
  </div>

  <!-- ===== Scripts ===== -->
  <script>
    const J = r => r.json();
    const NEXT_URL = "/chat.html";
    const genRef = () => "gptshelp_" + Date.now() + "_" + Math.random().toString(36).slice(2,8);

    /* ---------------- Public config ---------------- */
    let PAYSTACK_PUBLIC_KEY = null;
    let PRICE_PLUS = null; // GHS
    let PRICE_PRO  = null; // GHS

    async function loadConfigAndPrices(){
      try{
        const cfg = await fetch("/api/public-config").then(J);
        PAYSTACK_PUBLIC_KEY = cfg?.paystackPublicKey || null;
        // Prices exposed by server from Railway env:
        PRICE_PLUS = cfg?.pricePlusGhs ?? null;
        PRICE_PRO  = cfg?.priceProGhs  ?? null;

        // Render prices if present (format with ₵ + /mo or /yr)
        if(PRICE_PLUS!=null){
          document.getElementById("pricePlus").textContent = `₵${PRICE_PLUS} / mo`;
        }
        if(PRICE_PRO!=null){
          document.getElementById("pricePro").textContent = `₵${PRICE_PRO} / yr`;
        }
      }catch(e){
        console.warn("public-config load failed", e);
      }
    }

    /* ---------------- API helpers ---------------- */
    async function apiMe(){ try{ return await fetch("/api/me",{credentials:"include"}).then(J); }catch{return{}} }
    async function apiLogin(email, password){
      const r = await fetch("/api/login",{method:"POST",headers:{ "Content-Type":"application/json" },credentials:"include",body:JSON.stringify({email,password})});
      return r.json();
    }
    async function apiSignupFree(email, password){
      const r = await fetch("/api/signup-free",{method:"POST",headers:{ "Content-Type":"application/json" },credentials:"include",body:JSON.stringify({email,password})});
      return r.json();
    }
    async function apiForgot(email){
      const r = await fetch("/api/forgot-password",{method:"POST",headers:{ "Content-Type":"application/json" },credentials:"include",body:JSON.stringify({email})});
      return r.json();
    }
    async function apiResendVerify(){
      const r = await fetch("/api/resend-verify",{method:"POST",credentials:"include"});
      return r.json();
    }
    function authOK(r){ return r && (r.status==="ok"||r.status==="success") && (r.user?.email || r.email); }
    function isValidEmail(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }
    function setBtnLoading(btn, loading, label){
      if(!btn) return;
      if(loading){ btn.disabled=true; btn.dataset.prev = btn.textContent; btn.innerHTML = '<span class="spinner dark"></span> ' + (label || btn.textContent || 'Working…'); }
      else{ btn.disabled=false; btn.textContent = label || btn.dataset.prev || btn.textContent; }
    }

    /* ---------------- Header state ---------------- */
    async function reflectAuth(){
      const me = await apiMe();
      const openChatBtn = document.getElementById("openChatBtn");
      const loginBtn = document.getElementById("loginBtn");
      const signupBtn = document.getElementById("signupBtn");
      if(me?.status==="ok" && me.user?.email){
        openChatBtn.style.display="inline-block";
        openChatBtn.onclick = () => location.assign(NEXT_URL);
        loginBtn.textContent="Switch account";
        signupBtn.textContent="New account";
      }else{
        openChatBtn.style.display="none";
        loginBtn.textContent="Log in";
        signupBtn.textContent="Sign up for free";
      }
    }

    /* ---------------- Auth modals ---------------- */
    const loginOverlay = document.getElementById("loginOverlay");
    const loginBtnEl = document.getElementById("loginBtn");
    const loginClose = document.getElementById("loginClose");
    const loginStepEmail = document.getElementById("loginStepEmail");
    const loginStepPassword = document.getElementById("loginStepPassword");
    const loginEmail = document.getElementById("loginEmail");
    const loginEmailErr = document.getElementById("loginEmailErr");
    const loginEmailContinue = document.getElementById("loginEmailContinue");
    const loginEmailEcho = document.getElementById("loginEmailEcho");
    const loginChangeEmail = document.getElementById("loginChangeEmail");
    const loginPassword = document.getElementById("loginPassword");
    const loginErr = document.getElementById("loginErr");
    const loginSubmit = document.getElementById("loginSubmit");
    const loginGoSignup = document.getElementById("loginGoSignup");
    const forgotLink = document.getElementById("forgotLink");

    function openLogin(){
      loginEmailErr.textContent=''; loginErr.textContent='';
      loginOverlay.classList.add("open"); loginOverlay.setAttribute("aria-hidden","false");
      loginStepEmail.classList.add("active"); loginStepPassword.classList.remove("active");
      setTimeout(()=>loginEmail.focus(),20);
    }
    function closeLogin(){ loginOverlay.classList.remove("open"); loginOverlay.setAttribute("aria-hidden","true"); }
    function handleLoginEmailContinue(){
      const e = loginEmail.value.trim(); loginEmailErr.textContent='';
      if(!isValidEmail(e)){ loginEmailErr.textContent="Enter a valid email."; return; }
      loginEmailEcho.textContent=e; loginStepEmail.classList.remove("active"); loginStepPassword.classList.add("active"); setTimeout(()=>loginPassword.focus(),20);
    }
    async function handleLoginSubmit(){
      const email = (loginEmailEcho.textContent||loginEmail.value||"").trim();
      const pw = loginPassword.value;
      if(!isValidEmail(email)){ loginStepPassword.classList.remove("active"); loginStepEmail.classList.add("active"); loginEmailErr.textContent="Enter a valid email."; return; }
      if(!pw){ loginErr.textContent="Enter your password."; return; }
      setBtnLoading(loginSubmit,true,"Log in");
      try{
        const r = await apiLogin(email, pw);
        if(authOK(r)){
          try{ localStorage.setItem("userEmail", email); }catch{}
          const me = await apiMe();
          if(me?.user?.verified){ location.replace(NEXT_URL); }
          else{
            loginErr.style.color = "var(--ok)";
            loginErr.textContent = "Login ok. Please verify your email — we’ve sent a link.";
            await apiResendVerify().catch(()=>{});
          }
        }else{
          loginErr.textContent = r?.message || "Invalid email or password.";
        }
      }catch{
        loginErr.textContent = "Network error. Please try again.";
      }finally{
        setBtnLoading(loginSubmit,false,"Log in");
      }
    }
    loginBtnEl.addEventListener('click', openLogin);
    loginClose.addEventListener('click', closeLogin);
    loginOverlay.addEventListener('click',(e)=>{ if(e.target===loginOverlay) closeLogin(); });
    document.addEventListener('keydown',(e)=>{ if(e.key==="Escape" && loginOverlay.classList.contains("open")) closeLogin(); });
    loginEmailContinue.addEventListener('click', handleLoginEmailContinue);
    loginEmail.addEventListener('keydown',(e)=>{ if(e.key==='Enter') handleLoginEmailContinue(); });
    loginChangeEmail.addEventListener('click', ()=>{ loginStepPassword.classList.remove('active'); loginStepEmail.classList.add('active'); setTimeout(()=>loginEmail.focus(),20); });
    loginSubmit.addEventListener('click', handleLoginSubmit);
    loginPassword.addEventListener('keydown',(e)=>{ if(e.key==='Enter') handleLoginSubmit(); });
    loginGoSignup.addEventListener('click',(e)=>{ e.preventDefault(); closeLogin(); openSignup(); });
    forgotLink.addEventListener('click', async (e)=>{
      e.preventDefault();
      const email = (loginEmailEcho.textContent||loginEmail.value||"").trim();
      if(!isValidEmail(email)){ loginEmailErr.textContent="Enter your email above first."; return; }
      loginErr.style.color=""; loginErr.textContent="";
      setBtnLoading(loginSubmit,true,"Sending…");
      try{
        await apiForgot(email);
        loginErr.style.color="var(--ok)";
        loginErr.textContent="Reset link sent. Check your email.";
      }catch{
        loginErr.textContent="Could not send reset email.";
      }finally{
        setBtnLoading(loginSubmit,false,"Log in");
      }
    });

    // Signup
    const signupOverlay = document.getElementById("signupOverlay");
    const signupBtn = document.getElementById("signupBtn");
    const signupClose = document.getElementById("signupClose");
    const signupStepEmail = document.getElementById("signupStepEmail");
    const signupStepPassword = document.getElementById("signupStepPassword");
    const signupEmail = document.getElementById("signupEmail");
    const signupEmailErr = document.getElementById("signupEmailErr");
    const signupEmailContinue = document.getElementById("signupEmailContinue");
    const signupEmailEcho = document.getElementById("signupEmailEcho");
    const signupChangeEmail = document.getElementById("signupChangeEmail");
    const signupPassword = document.getElementById("signupPassword");
    const signupPassword2 = document.getElementById("signupPassword2");
    const signupErr = document.getElementById("signupErr");
    const signupSubmit = document.getElementById("signupSubmit");
    const signupGoLogin = document.getElementById("signupGoLogin");
    const verifyInfo = document.getElementById("verifyInfo");
    const resendVerifyBtn = document.getElementById("resendVerifyBtn");

    function openSignup(){
      signupEmailErr.textContent=''; signupErr.textContent=''; verifyInfo.style.display="none";
      signupOverlay.classList.add("open"); signupOverlay.setAttribute("aria-hidden","false");
      signupStepEmail.classList.add("active"); signupStepPassword.classList.remove("active");
      setTimeout(()=>signupEmail.focus(),20);
    }
    function closeSignup(){ signupOverlay.classList.remove("open"); signupOverlay.setAttribute("aria-hidden","true"); }
    function handleSignupEmailContinue(){
      const e = signupEmail.value.trim(); signupEmailErr.textContent='';
      if(!isValidEmail(e)){ signupEmailErr.textContent="Enter a valid email."; return; }
      signupEmailEcho.textContent = e; signupStepEmail.classList.remove("active"); signupStepPassword.classList.add("active"); setTimeout(()=>signupPassword.focus(),20);
    }
    function passwordOk(p){ return typeof p === 'string' && p.length >= 8; }
    async function handleSignupSubmit(){
      signupErr.style.color = "";
      signupErr.textContent = "";
      verifyInfo.style.display = "none";

      const email = (signupEmailEcho.textContent||signupEmail.value||"").trim();
      const p1 = signupPassword.value, p2 = signupPassword2.value;

      if(!isValidEmail(email)){
        signupStepPassword.classList.remove("active");
        signupStepEmail.classList.add("active");
        signupEmailErr.textContent="Enter a valid email.";
        return;
      }
      if(!passwordOk(p1)){ signupErr.textContent="Password must be at least 8 characters."; return; }
      if(p1!==p2){ signupErr.textContent="Passwords do not match."; return; }

      setBtnLoading(signupSubmit,true,"Create account");
      try{
        await apiSignupFree(email, p1);
        try{ localStorage.setItem("userEmail", email); }catch{}
        verifyInfo.style.display="block";
        signupErr.style.color="var(--ok)";
        signupErr.textContent="Almost done — check your inbox and verify your email to continue.";
      }catch{
        verifyInfo.style.display="block";
        signupErr.style.color="var(--ok)";
        signupErr.textContent="Almost done — check your inbox and verify your email to continue.";
      }finally{
        setBtnLoading(signupSubmit,false,"Create account");
      }
    }
    signupBtn.addEventListener('click', openSignup);
    signupClose.addEventListener('click', closeSignup);
    signupOverlay.addEventListener('click',(e)=>{ if(e.target===signupOverlay) closeSignup(); });
    document.addEventListener('keydown',(e)=>{ if(e.key==="Escape" && signupOverlay.classList.contains("open")) closeSignup(); });
    signupEmailContinue.addEventListener('click', handleSignupEmailContinue);
    signupEmail.addEventListener('keydown',(e)=>{ if(e.key==='Enter') handleSignupEmailContinue(); });
    signupChangeEmail.addEventListener('click', ()=>{ signupStepPassword.classList.remove('active'); signupStepEmail.classList.add('active'); setTimeout(()=>signupEmail.focus(),20); });
    signupSubmit.addEventListener('click', handleSignupSubmit);
    signupPassword2.addEventListener('keydown',(e)=>{ if(e.key==='Enter') handleSignupSubmit(); });
    signupGoLogin.addEventListener('click',(e)=>{ e.preventDefault(); closeSignup(); openLogin(); });
    resendVerifyBtn.addEventListener('click', async ()=>{
      resendVerifyBtn.disabled = true;
      try{ await apiResendVerify(); resendVerifyBtn.textContent = "Sent!"; setTimeout(()=>resendVerifyBtn.textContent="Resend email",1500); }
      catch{ resendVerifyBtn.textContent = "Failed"; setTimeout(()=>resendVerifyBtn.textContent="Resend email",1500); }
      finally{ resendVerifyBtn.disabled = false; }
    });

    /* ---------------- Payments: server-init ---------------- */
    async function startSubscriptionByLabel(planLabel){
      // Ensure signed in
      const me = await apiMe();
      if(!(me?.status==="ok" && me.user?.email)){ openLogin(); return; }

      // Ask server to initialize with PLAN configured in dashboard (server knows plan codes)
      const btn =
        planLabel === "PLUS" ? document.getElementById("plusMonthlyBtn")
      : planLabel === "PRO"  ? document.getElementById("proAnnualBtn")
      : null;

      setBtnLoading(btn, true, "Starting…");
      try{
        const r = await fetch("/api/paystack/init",{
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          credentials:"include",
          body:JSON.stringify({ plan: planLabel }) // "PLUS" or "PRO"
        });
        const j = await r.json().catch(()=> ({}));
        if(r.ok && j.authorization_url){
          location.href = j.authorization_url; // Paystack hosted page
        }else{
          alert(j?.message || "Could not start payment. Please try again.");
        }
      }catch{
        alert("Network error. Please try again.");
      }finally{
        setBtnLoading(btn, false);
      }
    }

    // Paywall overlay helpers (optional)
    const paywallOverlay = document.getElementById("paywallOverlay");
    const paywallClose = document.getElementById("paywallClose");
    const paywallMonthly = document.getElementById("paywallMonthly");
    const paywallAnnual = document.getElementById("paywallAnnual");
    function openPaywall(){ paywallOverlay.classList.add("open"); paywallOverlay.setAttribute("aria-hidden","false"); }
    function closePaywall(){ paywallOverlay.classList.remove("open"); paywallOverlay.setAttribute("aria-hidden","true"); }
    paywallClose.addEventListener('click', closePaywall);
    paywallOverlay.addEventListener('click', (e)=>{ if(e.target===paywallOverlay) closePaywall(); });
    paywallMonthly.addEventListener('click', ()=> startSubscriptionByLabel("PLUS"));
    paywallAnnual .addEventListener('click', ()=> startSubscriptionByLabel("PRO"));

    // Buttons
    document.getElementById("plusMonthlyBtn").addEventListener('click', ()=> startSubscriptionByLabel("PLUS"));
    document.getElementById("proAnnualBtn").addEventListener('click', ()=> startSubscriptionByLabel("PRO"));
    document.getElementById("startFreeBtn").addEventListener('click', async ()=>{
      const me = await apiMe();
      if(me?.status==="ok" && me.user?.email){
        if(me.user.verified) location.assign(NEXT_URL);
        else { alert("Please verify your email first. We’ve sent you a link."); await apiResendVerify().catch(()=>{}); }
      } else {
        openSignup();
      }
    });

    // Header buttons
    document.getElementById("openChatBtn").addEventListener("click", ()=> location.assign(NEXT_URL));

    // Init
    document.getElementById("year").textContent = new Date().getFullYear();
    loadConfigAndPrices();
    reflectAuth();
  </script>

  <noscript>
    <div style="max-width:860px;margin:1rem auto;padding:1rem;border:1px solid #eee;border-radius:8px;background:#fff3cd;color:#664d03">
      GPTs Help needs JavaScript enabled to run. Please enable JavaScript in your browser settings.
    </div>
  </noscript>
</body>
</html>