<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GPTs Help – Learn Smarter with AI</title>
  <style>
    :root{
      --brand:#6f42c1;  /* Purple */
      --accent:#ffc107; /* Amber */
      --bg:#f8f9fa;
      --text:#212529;
      --muted:#6c757d;
      --card:#ffffff;
      --border:#e9ecef;
      --danger:#dc3545;
      --success:#198754;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:var(--bg)}
    a{color:var(--brand);text-decoration:none}
    a:hover{text-decoration:underline}

    /* Header */
    header{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--border)}
    .nav{max-width:1200px;margin:0 auto;padding:12px 20px;display:flex;align-items:center;gap:16px}
    .logo{font-weight:800;color:var(--brand)}
    .spacer{flex:1}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:.7rem 1.1rem;border-radius:10px;border:1px solid var(--border);background:#fff;color:var(--brand);font-weight:700;cursor:pointer}
    .btn-primary{background:var(--brand);color:#fff;border-color:transparent}
    .btn-accent{background:var(--accent);color:#000;border-color:transparent}

    /* Hero */
    .hero{background:linear-gradient(135deg,var(--brand),#a47dff);color:#fff;text-align:center;padding:72px 20px}
    .hero h1{font-size:clamp(2rem,4vw,3rem);margin:.2rem 0 .8rem}
    .hero p{font-size:1.15rem;opacity:.95;max-width:720px;margin:0 auto 1.4rem}
    .hero .cta{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}

    /* Sections */
    .container{max-width:1200px;margin:0 auto;padding:32px 20px}
    h2{margin:.25rem 0 1rem}
    .features{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px;box-shadow:0 4px 10px rgba(0,0,0,.05)}
    .plans{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:18px;margin-top:10px}
    .plan{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:22px;text-align:center;position:relative}
    .plan .badge{position:absolute;top:12px;right:12px;background:var(--brand);color:#fff;border-radius:999px;font-size:.75rem;padding:.25rem .5rem}
    .price{font-size:2rem;color:var(--brand);margin:.2rem 0 1rem}
    .plan ul{list-style:none;padding:0;margin:12px 0;color:var(--muted);text-align:left}
    .plan li{margin:.35rem 0}

    /* Testimonials */
    .testimonials{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
    .testimonial{background:#fff;border:1px solid var(--border);border-radius:12px;padding:18px;font-style:italic}

    footer{text-align:center;color:var(--muted);padding:28px;border-top:1px solid var(--border);margin-top:24px;background:#fff}

    /* Auth modal */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:1000}
    .overlay.open{display:flex}
    .modal{width:min(480px,92vw);background:#fff;border-radius:16px;border:1px solid var(--border);box-shadow:0 20px 40px rgba(0,0,0,.15)}
    .modal header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
    .modal h3{margin:0;font-size:18px}
    .close{border:0;background:transparent;cursor:pointer;font-size:22px;color:#555;padding:4px 8px}
    .modal body{display:block;padding:18px}
    .tabs{display:flex;gap:6px;background:#f1f3f5;border-bottom:1px solid var(--border)}
    .tab{flex:1;text-align:center;padding:10px;border:0;background:transparent;cursor:pointer;font-weight:700}
    .tab.active{background:#fff;border-bottom:2px solid var(--brand);color:var(--brand)}
    .form{padding:16px}
    .row{display:flex;flex-direction:column;gap:6px;margin-bottom:12px}
    .row label{font-size:13px;color:#555}
    .row input{padding:10px;border:1px solid #ced4da;border-radius:10px;font-size:15px}
    .hint{font-size:12px;color:var(--muted)}
    .error{font-size:13px;color:var(--danger);display:none;margin-top:4px}
    .error.show{display:block}
    .success{font-size:13px;color:var(--success);display:none;margin-top:4px}
    .success.show{display:block}
    .actions{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:4px}
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="nav">
      <div class="logo">GPTs Help</div>
      <div class="spacer"></div>
      <button id="authBtn" class="btn">Log in / Sign up</button>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <h1>Master Math & Create Content with AI</h1>
    <p>Get step-by-step math tutoring and professional AI content tools – all in one subscription.</p>
    <div class="cta">
      <button class="btn btn-accent" id="heroStart">Start Free</button>
      <a class="btn" href="#pricing">See pricing</a>
    </div>
  </section>

  <!-- Features -->
  <section class="container">
    <h2>Why Choose GPTs Help?</h2>
    <div class="features">
      <div class="card"><h3>Step-by-Step Math</h3><p>Clear explanations with proofs, hints, and multiple methods.</p></div>
      <div class="card"><h3>Exam-Ready Practice</h3><p>Adaptive practice sets with instant feedback.</p></div>
      <div class="card"><h3>Content Suite</h3><p>Generate polished blog posts, essays, and scripts in minutes.</p></div>
      <div class="card"><h3>Secure & Fast</h3><p>Trusted Paystack payments. Your data stays private.</p></div>
    </div>
  </section>

  <!-- Pricing -->
  <section class="container" id="pricing">
    <h2>Choose Your Plan</h2>

    <div class="plans">
      <div class="plan">
        <h3>Free Plan</h3>
        <div class="price">₵0 / mo</div>
        <ul>
          <li>Up to 10 math problems / month</li>
          <li>Basic AI explanations</li>
          <li>Limited content exports</li>
        </ul>
        <button class="btn" id="freeBtn">Sign up free</button>
      </div>

      <div class="plan">
        <div class="badge">Popular</div>
        <h3>Plus Monthly</h3>
        <div class="price">₵99 / mo</div>
        <ul>
          <li>Unlimited math problem solving</li>
          <li>Advanced explanations & proofs</li>
          <li>Full content suite</li>
        </ul>
        <button class="btn btn-primary" id="plusBtn">Subscribe monthly</button>
      </div>

      <div class="plan">
        <h3>Pro Annual</h3>
        <div class="price">₵790 / yr</div>
        <ul>
          <li>Everything in Plus</li>
          <li>Annual discount (save 34%)</li>
          <li>Team collaboration tools</li>
        </ul>
        <button class="btn btn-primary" id="proBtn">Subscribe annually</button>
      </div>
    </div>
  </section>

  <!-- Testimonials -->
  <section class="container">
    <h2>What Our Users Say</h2>
    <div class="testimonials">
      <div class="testimonial">“I finally understood calculus limits—your hints + step-by-step solved it!”<br><strong>— Ama A., Student</strong></div>
      <div class="testimonial">“We cut blog production time by 70%. The content suite is a lifesaver.”<br><strong>— Michael T., Creator</strong></div>
    </div>
  </section>

  <footer>
    &copy; <span id="year"></span> GPTs Help. All rights reserved.
  </footer>

  <!-- Auth Modal -->
  <div class="overlay" id="authOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <header>
        <h3 id="authTitle">Welcome</h3>
        <button class="close" id="authClose" aria-label="Close">×</button>
      </header>
      <div class="tabs">
        <button class="tab active" id="tabSignIn">Log in</button>
        <button class="tab" id="tabSignUp">Sign up free</button>
      </div>
      <div class="form" id="formSignIn">
        <div class="row">
          <label for="loginEmail">Email</label>
          <input id="loginEmail" type="email" placeholder="you@example.com" autocomplete="email">
        </div>
        <div class="row">
          <label for="loginPassword">Password</label>
          <input id="loginPassword" type="password" placeholder="Enter password" autocomplete="current-password">
          <div class="hint"><a href="/reset-password">Forgot password?</a></div>
        </div>
        <div class="error" id="loginErr"></div>
        <div class="actions">
          <button class="btn btn-primary" id="loginBtn">Log in</button>
        </div>
      </div>

      <div class="form" id="formSignUp" style="display:none">
        <div class="row">
          <label for="signupEmail">Email</label>
          <input id="signupEmail" type="email" placeholder="you@example.com" autocomplete="email">
        </div>
        <div class="row">
          <label for="signupPassword">Password</label>
          <input id="signupPassword" type="password" placeholder="At least 8 characters" autocomplete="new-password">
          <div class="hint">By continuing, you agree to our Terms and Privacy Policy.</div>
        </div>
        <div class="error" id="signupErr"></div>
        <div class="success" id="signupOk"></div>
        <div class="actions">
          <button class="btn btn-primary" id="signupBtn">Create account</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Paystack -->
  <script src="https://js.paystack.co/v2/inline.js"></script>
  <script>
    // ------- State -------
    let appCfg = null;   // plan codes, public key
    let session = null;  // me()
    let postAuthAction = null; // optional function to run right after auth closes

    // ------- Helpers -------
    function $(id){ return document.getElementById(id); }
    function openAuth(mode='login', nextAction=null){
      postAuthAction = nextAction || null;
      $('authOverlay').classList.add('open');
      $('authOverlay').setAttribute('aria-hidden','false');
      setMode(mode);
      setTimeout(()=> (mode==='login' ? $('loginEmail') : $('signupEmail')).focus(), 30);
    }
    function closeAuth(){
      $('authOverlay').classList.remove('open');
      $('authOverlay').setAttribute('aria-hidden','true');
      if (postAuthAction){ const fn = postAuthAction; postAuthAction = null; fn(); }
    }
    function setMode(mode){
      const loginActive = mode==='login';
      $('tabSignIn').classList.toggle('active', loginActive);
      $('tabSignUp').classList.toggle('active', !loginActive);
      $('formSignIn').style.display = loginActive ? 'block' : 'none';
      $('formSignUp').style.display = loginActive ? 'none' : 'block';
      $('loginErr').classList.remove('show'); $('signupErr').classList.remove('show'); $('signupOk').classList.remove('show');
    }
    function toastError(el, msg){ el.textContent = msg; el.classList.add('show'); }

    async function fetchJSON(url, opts={}){
      const r = await fetch(url, { credentials:'include', ...opts });
      if (!r.ok) throw new Error(await r.text());
      return r.json();
    }

    async function loadConfig(){
      try {
        appCfg = await fetchJSON('/api/public-config');
      } catch {
        appCfg = { currency:'GHS' };
      }
    }
    async function loadSession(){
      try {
        const me = await fetchJSON('/api/me');
        session = me.user;
      } catch {
        session = null;
      }
      renderHeader();
    }
    function renderHeader(){
      const btn = $('authBtn');
      if (session?.email){
        btn.textContent = 'Open Chat';
        btn.classList.add('btn-primary');
        btn.onclick = ()=> window.location.href = '/chat.html';
      }else{
        btn.textContent = 'Log in / Sign up';
        btn.classList.remove('btn-primary');
        btn.onclick = ()=> openAuth('login');
      }
    }

    // ------- Auth actions -------
    $('tabSignIn').addEventListener('click', ()=> setMode('login'));
    $('tabSignUp').addEventListener('click', ()=> setMode('signup'));
    $('authClose').addEventListener('click', closeAuth);
    $('authOverlay').addEventListener('click', (e)=>{ if(e.target===e.currentTarget) closeAuth(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && $('authOverlay').classList.contains('open')) closeAuth(); });

    $('loginBtn').addEventListener('click', async ()=>{
      $('loginErr').classList.remove('show');
      const email = $('loginEmail').value.trim();
      const password = $('loginPassword').value;
      if(!email || !password){ return toastError($('loginErr'), 'Enter your email and password.'); }
      try{
        const res = await fetchJSON('/api/login', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ email, password })
        });
        session = res.user;
        renderHeader();
        closeAuth();
      }catch(e){
        toastError($('loginErr'), 'Invalid email or password.');
      }
    });

    $('signupBtn').addEventListener('click', async ()=>{
      $('signupErr').classList.remove('show');
      const email = $('signupEmail').value.trim();
      const password = $('signupPassword').value;
      if(!email || password.length<8){ return toastError($('signupErr'), 'Use a valid email and a password of at least 8 characters.'); }
      try{
        const res = await fetchJSON('/api/signup-free', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ email, password })
        });
        session = { email };
        $('signupOk').textContent = 'Account created! Redirecting…';
        $('signupOk').classList.add('show');
        renderHeader();
        // After sign-up, go straight to chat
        setTimeout(()=> { closeAuth(); window.location.href='/chat.html'; }, 600);
      }catch(e){
        toastError($('signupErr'), 'Could not create account. Try a different email.');
      }
    });

    // ------- Paystack flows -------
    function ensureCfg(){ if(!appCfg?.paystackPublicKey) { alert('Payment key not loaded.'); return false; } return true; }
    function needAuth(next){ if(!session?.email){ openAuth('login', next); return true; } return false; }

    function newTx({ planCode, label }){
      const popup = new PaystackPop();
      popup.newTransaction({
        key: appCfg.paystackPublicKey,
        email: session.email,
        currency: appCfg.currency || 'GHS',
        plan: planCode,
        reference: "gptshelp_" + Date.now() + "_" + Math.random().toString(36).slice(2,8),
        callback: (response)=>{
          fetchJSON('/api/paystack/verify', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ reference: response.reference })
          }).then(r=>{
            if (r.status === 'success') {
              alert(label + ' subscription activated!');
              window.location.href = '/chat.html';
            } else {
              alert('Verification pending. Ref: ' + response.reference);
            }
          }).catch(()=> alert('Verification failed.'));
        },
        onCancel: ()=> alert('Payment cancelled.')
      });
    }

    $('freeBtn').addEventListener('click', ()=>{
      // Force sign-up modal
      openAuth('signup', ()=> window.location.assign('/chat.html'));
    });
    $('plusBtn').addEventListener('click', ()=>{
      if(!ensureCfg()) return;
      if (needAuth(()=> $('plusBtn').click())) return;
      if(!appCfg.planPlusMonthly){ alert('Plan code not configured.'); return; }
      newTx({ planCode: appCfg.planPlusMonthly, label:'Plus Monthly' });
    });
    $('proBtn').addEventListener('click', ()=>{
      if(!ensureCfg()) return;
      if (needAuth(()=> $('proBtn').click())) return;
      if(!appCfg.planProAnnual){ alert('Plan code not configured.'); return; }
      newTx({ planCode: appCfg.planProAnnual, label:'Pro Annual' });
    });
    $('heroStart').addEventListener('click', ()=> openAuth('signup'));

    // ------- Init -------
    (async function init(){
      $('year').textContent = new Date().getFullYear();
      await loadConfig();
      await loadSession();
    })();
  </script>
</body>
</html>
