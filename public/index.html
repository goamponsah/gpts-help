<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GPTs Help ‚Äî Math Tutor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0e0f13" />
  <style>
    :root{
      --bg:#0e0f13; --panel:#10121a; --muted:#a9b1c7; --text:#e7eaf1; --brand:#5865f2;
      --border:#222738; --good:#22c55e; --warn:#f59e0b; --danger:#ef4444;
      --hero-grad: radial-gradient(1200px 400px at 50% -200px, rgba(88,101,242,.12), transparent 60%);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif;}

    /* Top bar */
    .nav{max-width:1100px;margin:0 auto;padding:14px 16px;display:flex;align-items:center;gap:12px}
    .logo{font-weight:800;letter-spacing:.2px}
    .spacer{flex:1}
    .btn{border:1px solid var(--border);background:#141722;color:var(--text);border-radius:9999px;padding:8px 14px;cursor:pointer;font-size:14px}
    .btn.primary{background:var(--brand);border-color:transparent;color:#fff}
    .btn.ghost{background:transparent}
    .btn:disabled{opacity:.65;cursor:not-allowed}

    /* Verify banner (namespaced) */
    .gvh-verify{display:none;margin:10px auto 0;max-width:1100px;background:#10131a;border:1px solid #2a2f45;border-radius:12px;padding:12px 14px;color:#dfe3ec}
    .gvh-verify.gvh-show{display:flex;gap:10px;align-items:center;justify-content:space-between}
    .gvh-verify b{color:#fff}
    .gvh-row{display:flex;gap:8px}
    .gvh-btn{border:1px solid #2a2f45;background:#141722;color:#e7eaf1;border-radius:9999px;padding:8px 12px;cursor:pointer;font-size:13px}
    .gvh-toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);padding:10px 14px;font-size:13px;background:#141722;color:#e7eaf1;border:1px solid #2a2f45;border-radius:9999px;display:none;z-index:1100}
    .gvh-toast.gvh-show{display:block}

    /* Hero */
    .hero{max-width:1100px;margin:0 auto;padding:28px 16px 10px;background:var(--hero-grad)}
    .hgrid{display:grid;grid-template-columns:1.1fr .9fr;gap:20px}
    @media (max-width:900px){ .hgrid{grid-template-columns:1fr} }
    .h1{font-size:42px;line-height:1.08;margin:10px 0 8px;font-weight:800}
    .sub{color:var(--muted);font-size:16px;max-width:54ch}
    .cta-row{display:flex;gap:8px;margin-top:14px;flex-wrap:wrap}

    /* Cards */
    .grid{max-width:1100px;margin:16px auto;padding:0 16px;display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px}
    .card h3{margin:.2rem 0 .3rem}
    .muted{color:var(--muted)}
    .pill{display:inline-block;font-size:12px;border:1px solid var(--border);padding:3px 8px;border-radius:999px;color:#c9d1e6}
    .uploader{display:grid;gap:10px;margin-top:10px}
    .uploader input[type="file"]{display:none}

    /* Pricing */
    #pricing{max-width:1100px;margin:22px auto;padding:0 16px}
    .price-row{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    @media (max-width:900px){ .price-row{grid-template-columns:1fr} }
    .plan{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px}
    .plan h4{margin:.2rem 0}
    .price{font-size:28px;font-weight:800;margin:6px 0}
    .features{color:var(--muted);font-size:14px;line-height:1.55}
    .center{text-align:center}

    /* Modal (auth) */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:1000}
    .overlay.open{display:flex}
    .modal{width:min(520px,92vw);background:#0f1117;border:1px solid var(--border);border-radius:16px;padding:18px;box-shadow:0 18px 40px rgba(0,0,0,.45)}
    .modal h3{margin:.2rem 0 .6rem}
    .row{display:grid;gap:8px}
    .modal input{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:9999px;background:#0e0f13;color:#e7eaf1;font-size:14px}
    .x{border:0;background:transparent;color:#aab1c7;cursor:pointer;font-size:20px}
    .modal-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <!-- Top bar -->
  <header class="nav">
    <div class="logo">GPTs Help</div>
    <div class="spacer"></div>
    <button class="btn ghost" id="loginBtn">Log in</button>
    <button class="btn primary" id="signupBtn">Sign up</button>
  </header>

  <!-- Email verify banner -->
  <div class="gvh-verify" id="gvhVerify">
    <div>üìß <b>Email not verified.</b> Please check your inbox to finish sign-up.</div>
    <div class="gvh-row">
      <button class="gvh-btn" id="gvhResend">Resend email</button>
      <button class="gvh-btn" id="gvhDismiss">Dismiss</button>
    </div>
  </div>
  <div class="gvh-toast" id="gvhToast">Sent</div>

  <!-- Hero -->
  <section class="hero">
    <div class="hgrid">
      <div>
        <div class="pill">Step-by-Step Math</div>
        <h1 class="h1">Understand every step, not just the answer.</h1>
        <p class="sub">Upload a problem or type a question. Free plan includes <b>2 photo solves</b> and <b>10 text questions</b>. Upgrade any time.</p>
        <div class="cta-row">
          <button class="btn primary" id="openChat">Open Chat</button>
          <a class="btn" href="#pricing">Compare plans</a>
        </div>
      </div>
      <div class="card">
        <h3>üì∑ Photo Solve <span class="pill">2 free</span></h3>
        <p class="muted">Upload a photo of a math problem. We show precise working and alternatives.</p>
        <div class="uploader">
          <input type="file" id="photoFile" accept="image/png,image/jpeg,image/jpg,image/webp" />
          <div>
            <button class="btn" id="photoBrowse">Upload photo</button>
            <span class="small" id="photoHint">PNG, JPG or WEBP (‚â§ 6MB)</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Feature cards -->
  <section class="grid">
    <div class="card">
      <h3>üßÆ Worked solutions</h3>
      <p class="muted">Clear, line-by-line reasoning so you actually learn the method.</p>
    </div>
    <div class="card">
      <h3>üìù Explanations</h3>
      <p class="muted">Multiple methods when helpful, with checks and common mistakes.</p>
    </div>
    <div class="card">
      <h3>üéØ Focused on quality</h3>
      <p class="muted">We care about correctness and clarity more than anything else.</p>
    </div>
  </section>

  <!-- Pricing -->
  <section id="pricing">
    <h2>Pricing</h2>
    <div class="price-row">
      <div class="plan">
        <h4>Free</h4>
        <div class="price">GHS 0</div>
        <div class="features">
          ‚úÖ 10 text questions/day<br/>
          ‚úÖ 2 photo solves/day<br/>
          ‚ùå Priority support
        </div>
      </div>
      <div class="plan">
        <h4>Plus (Monthly)</h4>
        <div class="price">GHS ‚Äî</div>
        <div class="features">
          ‚úÖ Unlimited text & photos<br/>
          ‚úÖ Faster responses<br/>
          ‚úÖ Priority support
        </div>
        <div class="center"><a class="btn primary" href="#!" id="buyPlus">Upgrade</a></div>
      </div>
      <div class="plan">
        <h4>Pro (Annual)</h4>
        <div class="price">GHS ‚Äî</div>
        <div class="features">
          ‚úÖ Everything in Plus<br/>
          ‚úÖ Best value yearly
        </div>
        <div class="center"><a class="btn primary" href="#!" id="buyPro">Upgrade</a></div>
      </div>
    </div>
  </section>

  <!-- Auth Modals -->
  <div class="overlay" id="signupOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-head">
        <h3>Create your free account</h3>
        <button class="x" data-close="#signupOverlay">√ó</button>
      </div>
      <p class="small">Start with the free plan. Upgrade anytime.</p>
      <div class="row">
        <input type="email" id="suEmail" placeholder="Email" autocomplete="email" />
        <input type="password" id="suPass" placeholder="Password (min 8 chars)" autocomplete="new-password" />
        <button class="btn primary" id="createAccount">Create account</button>
        <div class="small" id="suNote"></div>
      </div>
    </div>
  </div>

  <div class="overlay" id="loginOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-head">
        <h3>Log in</h3>
        <button class="x" data-close="#loginOverlay">√ó</button>
      </div>
      <div class="row">
        <input type="email" id="liEmail" placeholder="Email" autocomplete="email" />
        <input type="password" id="liPass" placeholder="Password" autocomplete="current-password" />
        <button class="btn primary" id="doLogin">Log in</button>
        <div class="small" id="liNote"></div>
      </div>
    </div>
  </div>

  <script>
    const $ = (sel)=>document.querySelector(sel);
    const api = {
      me: ()=>fetch('/api/me',{credentials:'include'}).then(r=>r.json()).catch(()=>null),
      signup:(email,password)=>fetch('/api/signup-free',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({email,password})}).then(r=>r.json()),
      login:(email,password)=>fetch('/api/login',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({email,password})}).then(r=>r.json()),
      resend:()=>fetch('/api/resend-verification',{method:'POST',credentials:'include'}),
      public:()=>fetch('/api/public-config').then(r=>r.json()),
      photoSolve:(fd)=>fetch('/api/photo-solve',{method:'POST',credentials:'include',body:fd}).then(r=>r.json())
    };

    // ----- Email verify banner -----
    const vb = $('#gvhVerify'), toast = $('#gvhToast');
    function showToast(msg){ toast.textContent=msg; toast.classList.add('gvh-show'); setTimeout(()=>toast.classList.remove('gvh-show'),1500); }
    $('#gvhDismiss').addEventListener('click', ()=> vb.classList.remove('gvh-show'));
    $('#gvhResend').addEventListener('click', async ()=>{
      const r = await api.resend().catch(()=>null);
      showToast(r && r.ok !== false ? 'Verification email sent.' : 'Could not send.');
    });

    async function refreshBanner(){
      try{
        const me = await api.me();
        if(me?.user?.verified === false){ vb.classList.add('gvh-show'); } else { vb.classList.remove('gvh-show'); }
      }catch{}
    }

    // ----- Nav buttons -----
    $('#signupBtn').addEventListener('click', ()=> openModal('#signupOverlay'));
    $('#loginBtn').addEventListener('click', ()=> openModal('#loginOverlay'));
    $('#openChat').addEventListener('click', ()=> location.href='/chat.html');

    // ----- Modals -----
    function openModal(id){ const el=$(id); el.classList.add('open'); el.setAttribute('aria-hidden','false'); }
    function closeModal(id){ const el=$(id); el.classList.remove('open'); el.setAttribute('aria-hidden','true'); }
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('[data-close]'); if(btn){ e.preventDefault(); closeModal(btn.getAttribute('data-close')); }
      if(e.target.classList.contains('overlay')){ e.target.classList.remove('open'); }
    });

    // ----- Sign up -----
    $('#createAccount').addEventListener('click', async ()=>{
      const email = $('#suEmail').value.trim();
      const pass  = $('#suPass').value;
      const note  = $('#suNote');
      note.textContent = '';
      if(!email || !/.+@.+\..+/.test(email)) { note.textContent='Enter a valid email.'; return; }
      if(!pass || pass.length<8) { note.textContent='Password must be at least 8 characters.'; return; }
      const r = await api.signup(email, pass).catch(()=>({status:'error'}));
      if(r.status==='success'){
        note.textContent = 'Account created. Please check your email to verify.';
        alert('Account created! Please check your email to verify.');
        closeModal('#signupOverlay');
        refreshBanner();
      }else{
        note.textContent = r.message || 'Could not create account.';
      }
    });

    // ----- Log in -----
    $('#doLogin').addEventListener('click', async ()=>{
      const email = $('#liEmail').value.trim();
      const pass  = $('#liPass').value;
      const note  = $('#liNote');
      note.textContent='';
      if(!email || !pass){ note.textContent='Email and password required.'; return; }
      const r = await api.login(email, pass).catch(()=>({status:'error'}));
      if(r.status==='ok'){ closeModal('#loginOverlay'); refreshBanner(); alert('Logged in!'); }
      else { note.textContent = r.message || 'Login failed.'; }
    });

    // ----- Photo Solve on homepage -----
    const photoFile = $('#photoFile');
    $('#photoBrowse').addEventListener('click', ()=> photoFile.click());
    photoFile.addEventListener('change', async ()=>{
      const file = photoFile.files && photoFile.files[0];
      if(!file) return;
      const okTypes=['image/png','image/jpeg','image/jpg','image/webp'];
      if(!okTypes.includes(file.type)){ alert('Please choose a PNG, JPG, or WEBP image.'); photoFile.value=''; return; }
      if(file.size>6*1024*1024){ alert('Image is larger than 6MB.'); photoFile.value=''; return; }

      // Check auth + verification
      const me = await api.me().catch(()=>null);
      if(!me || me.status!=='ok' || !me.user?.email){
        openModal('#signupOverlay');
        alert('Create an account first. We‚Äôll email you a verification link.');
        photoFile.value=''; return;
      }
      if(me.user.verified === false){
        alert('Please verify your email first (check your inbox).');
        vb.classList.add('gvh-show'); photoFile.value=''; return;
      }

      // Optional note
      const note = prompt('Optional: add a short note about the problem') || '';
      const fd = new FormData();
      fd.append('image', file);
      fd.append('gptType', 'math');
      if(note) fd.append('attempt', note);

      try{
        const res = await api.photoSolve(fd);
        if (res?.status === 'limit') {
          const go = confirm('Free photo limit reached. See plans?');
          if(go) location.hash = '#pricing';
          return;
        }
        if(res?.conversationId){
          // Jump straight into the chat containing the solve
          location.href = `/chat.html?c=${encodeURIComponent(res.conversationId)}`;
        }else{
          alert('Uploaded, but something was off. Please open chat to view.');
        }
      }catch{
        alert('Photo solve failed. Please try again.');
      }finally{
        photoFile.value='';
      }
    });

    // ----- Pricing buttons (placeholder; your Paystack flow can hook here) -----
    async function loadPublicConfig(){
      const p = await api.public().catch(()=>null);
      // If you later wire Paystack plan codes, you can use p.planPlusMonthly, p.planProAnnual, etc.
      // For now we just anchor to #pricing and let chat‚Äôs user-menu ‚ÄúUpgrade plan‚Äù lead here.
    }
    $('#buyPlus').addEventListener('click', ()=> location.href='#pricing');
    $('#buyPro').addEventListener('click',  ()=> location.href='#pricing');

    // Init
    (async function init(){
      await loadPublicConfig();
      await refreshBanner();
    })();
  </script>
</body>
</html>